# Facebook Pixel Integration with Google Tag Manager## Step 1: Facebook Pixel Setup1. Create a Facebook Pixel in Facebook Business Manager if you haven't already2. Note down your Facebook Pixel ID## Step 2: Google Tag Manager Configuration1. Log in to Google Tag Manager2. Create a new Tag:   - Click "New Tag"   - Choose "Custom HTML" as the tag type   - Add the following Facebook Pixel base code:   ```html   <!-- Facebook Pixel Code -->   <script>   !function(f,b,e,v,n,t,s)   {if(f.fbq)return;n=f.fbq=function(){n.callMethod?   n.callMethod.apply(n,arguments):n.queue.push(arguments)};   if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';   n.queue=[];t=b.createElement(e);t.async=!0;   t.src=v;s=b.getElementsByTagName(e)[0];   s.parentNode.insertBefore(t,s)}(window, document,'script',   'https://connect.facebook.net/en_US/fbevents.js');   fbq('init', 'YOUR_PIXEL_ID'); // Replace with your Pixel ID   fbq('track', 'PageView');   </script>   ```3. Set Trigger to "All Pages" for the base pixel code## Step 3: Create Custom Events in GTM1. For specific events (like purchases, add to cart, etc.), create additional tags:   ```html   <script>   fbq('track', 'Purchase', {     value: {{transactionTotal}},     currency: 'USD'   });   </script>   ```2. Set appropriate triggers for each event (e.g., purchase confirmation page)## Step 4: Variables and Triggers1. Create Data Layer Variables for:   - Transaction values   - Product IDs   - Currency   - Any other relevant data2. Set up triggers for specific events:   - Purchase completion   - Add to cart   - View content   - Initiate checkout## Step 5: Testing1. Use GTM Preview mode to test2. Use Facebook Pixel Helper browser extension3. Verify events in Facebook Events Manager## Step 6: Next.js Implementation1. Add GTM script to your Next.js app by updating `layout.tsx`:   ```tsx   // Add in the head section:   <script     async     src={`https://www.googletagmanager.com/gtm.js?id=YOUR-GTM-ID`}   />   // Add after the <body> tag:   <noscript>     <iframe       src={`https://www.googletagmanager.com/ns.html?id=YOUR-GTM-ID`}       height="0"       width="0"       style={{ display: 'none', visibility: 'hidden' }}     />   </noscript>   ```2. Create a utility function in `utils/gtm.ts` for pushing events to the data layer:   ```typescript   export const pushToDataLayer = (event: any) => {     if (typeof window !== 'undefined') {       window.dataLayer = window.dataLayer || [];       window.dataLayer.push(event);     }   };   ```## Important Notes1. Always replace 'YOUR_PIXEL_ID' with your actual Facebook Pixel ID2. Replace 'YOUR-GTM-ID' with your actual GTM container ID3. Ensure GDPR/privacy compliance for EU users4. Test thoroughly in staging environment before deploying to production5. Consider implementing consent management if not already present## Common Events to Track- PageView (automatic)- ViewContent (product pages)- AddToCart- InitiateCheckout- Purchase- CompleteRegistration- Lead- Search## Best Practices1. Keep event names consistent2. Test all events in both GTM preview and Facebook Pixel Helper3. Document all custom events and their triggers4. Regular monitoring of data accuracy5. Maintain a clean GTM workspace with proper versioning